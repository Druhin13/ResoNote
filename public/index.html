<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Document metadata and global resources -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ResoNote Playlist Generator</title>

    <!-- App stylesheet (compiled/static CSS served by Express) -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- Favicon for browser tabs -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />

    <!-- Google Fonts: Inter (weights used by the UI) -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Lucide icon library (UMD build; used throughout via data-lucide attributes) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body>
    <div class="app-container">
      <!-- ===== Header: branding and tagline ===== -->
      <header class="app-header">
        <div class="header-content">
          <div class="logo">
            <i class="logo-icon"></i>
            <h1>ResoNote</h1>
          </div>
          <p class="tagline">AI-Powered Playlist Generator</p>
        </div>
      </header>

      <!-- ===== Main layout: left (controls) | right (results) ===== -->
      <div class="app-main">
        <!-- ===== Left Panel: configuration and inputs ===== -->
        <div class="left-panel">
          <div class="panel-scroll">
            <div class="section">
              <div class="section-header">
                <h2>
                  <i data-lucide="settings"></i>
                  Configuration
                </h2>
              </div>

              <div class="section-content">
                <!-- --- Seed Tracks: search input + random selection --- -->
                <div class="form-group">
                  <label class="form-label">Seed Tracks</label>
                  <div class="seed-tracks-container">
                    <div class="search-input-container">
                      <i data-lucide="search" class="search-icon"></i>
                      <!-- Live search box; results are rendered into #search-results -->
                      <input
                        type="text"
                        id="track-search"
                        placeholder="Search for tracks by name, artist, or lyrics..."
                        class="search-input"
                      />
                      <!-- Autocomplete dropdown; toggled via .hidden -->
                      <div id="search-results" class="search-results hidden">
                        <!-- Search results will be added here dynamically -->
                      </div>
                    </div>
                    <!-- Random seed trigger; disabled when seeds exist -->
                    <button id="random-track" class="btn btn-outline">
                      <i data-lucide="shuffle"></i>
                      Random
                    </button>
                  </div>

                  <!-- Selected seed track chips/cards appear here -->
                  <div id="selected-tracks" class="selected-tracks">
                    <div class="empty-selection">
                      <i data-lucide="music" class="empty-icon"></i>
                      <p>No tracks selected yet</p>
                      <span class="empty-subtext"
                        >Search for a track above or select a random track</span
                      >
                    </div>
                  </div>
                </div>

                <!-- --- Similarity Type: mode selection for scoring --- -->
                <div class="form-group">
                  <label class="form-label">Similarity Type</label>
                  <div class="radio-grid">
                    <!-- Combined: blends semantic + audio according to sliders -->
                    <label class="radio-card">
                      <input
                        type="radio"
                        name="similarity-type"
                        value="combined"
                        checked
                      />
                      <div class="radio-card-content">
                        <i data-lucide="layers"></i>
                        <span>Combined</span>
                      </div>
                    </label>

                    <!-- Semantic-only: tag-based similarity -->
                    <label class="radio-card">
                      <input
                        type="radio"
                        name="similarity-type"
                        value="semantic"
                      />
                      <div class="radio-card-content">
                        <i data-lucide="tag"></i>
                        <span>Semantic</span>
                      </div>
                    </label>

                    <!-- Audio-only: feature-space similarity -->
                    <label class="radio-card">
                      <input
                        type="radio"
                        name="similarity-type"
                        value="audio"
                      />
                      <div class="radio-card-content">
                        <i data-lucide="waves"></i>
                        <span>Audio</span>
                      </div>
                    </label>
                  </div>
                </div>

                <!-- --- Weights: control blend of semantic vs audio (visible in 'combined') --- -->
                <div id="weights-container" class="form-group">
                  <label class="form-label">Similarity Weights</label>
                  <div class="weight-controls">
                    <div class="weight-item">
                      <div class="weight-header">
                        <span>Semantic</span>
                        <!-- Live-updated percentage label -->
                        <span id="semantic-weight-value" class="weight-value"
                          >50%</span
                        >
                      </div>
                      <div class="slider-wrapper">
                        <!-- Slider value mirrored to audio slider (1 - value) -->
                        <input
                          type="range"
                          id="semantic-weight"
                          min="0"
                          max="1"
                          step="0.01"
                          value="0.5"
                          class="slider"
                        />
                      </div>
                    </div>

                    <div class="weight-item">
                      <div class="weight-header">
                        <span>Audio</span>
                        <span id="audio-weight-value" class="weight-value"
                          >50%</span
                        >
                      </div>
                      <div class="slider-wrapper">
                        <input
                          type="range"
                          id="audio-weight"
                          min="0"
                          max="1"
                          step="0.01"
                          value="0.5"
                          class="slider"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- --- Playlist Size: requested track count bounds --- -->
                <div class="form-group">
                  <label class="form-label">Playlist Size</label>
                  <div class="number-inputs">
                    <div class="number-input-group">
                      <label class="number-label">Min Tracks</label>
                      <input
                        type="number"
                        id="min-tracks"
                        min="1"
                        max="50"
                        value="5"
                        class="number-input"
                      />
                    </div>
                    <div class="number-input-group">
                      <label class="number-label">Max Tracks</label>
                      <input
                        type="number"
                        id="max-tracks"
                        min="1"
                        max="50"
                        value="10"
                        class="number-input"
                      />
                    </div>
                  </div>
                </div>

                <!-- --- Diversity Factor: re-ranking trade-off similarâ†”diverse --- -->
                <div class="form-group">
                  <div class="slider-label">
                    <div class="label-with-tooltip">
                      <span>Diversity Factor</span>
                      <!-- Tooltip icon; explains effect on re-ranking -->
                      <button
                        id="diversity-tooltip"
                        class="tooltip-trigger"
                        data-tooltip="Higher values increase playlist diversity"
                      >
                        <i data-lucide="help-circle"></i>
                      </button>
                    </div>
                    <span id="diversity-factor-value" class="weight-value"
                      >30%</span
                    >
                  </div>
                  <div class="slider-wrapper">
                    <input
                      type="range"
                      id="diversity-factor"
                      min="0"
                      max="1"
                      step="0.01"
                      value="0.3"
                      class="slider"
                    />
                  </div>
                  <!-- Visual cue for users about the slider semantics -->
                  <div class="slider-labels">
                    <span>Similar</span>
                    <span>Diverse</span>
                  </div>
                </div>

                <!-- --- Options: include seeds and allow variations --- -->
                <div class="form-group">
                  <label class="form-label">Options</label>
                  <div class="checkbox-list">
                    <!-- Include seeds within the final playlist -->
                    <label class="checkbox-item">
                      <div class="checkbox-wrapper">
                        <input
                          type="checkbox"
                          id="include-seed-tracks"
                          checked
                        />
                        <div class="checkbox-indicator">
                          <i data-lucide="check"></i>
                        </div>
                      </div>
                      <div class="checkbox-content">
                        <span class="checkbox-label"
                          >Include Seed Track(s)</span
                        >
                        <span class="checkbox-description"
                          >Add seed track(s) to the generated playlist</span
                        >
                      </div>
                    </label>

                    <!-- Allow covers/remixes/alternate versions in candidates -->
                    <label class="checkbox-item">
                      <div class="checkbox-wrapper">
                        <input
                          type="checkbox"
                          id="allow-track-variations"
                          checked
                        />
                        <div class="checkbox-indicator">
                          <i data-lucide="check"></i>
                        </div>
                      </div>
                      <div class="checkbox-content">
                        <span class="checkbox-label"
                          >Allow Track Variation(s)</span
                        >
                        <span class="checkbox-description"
                          >Include remixe(s), cover(s), and alternate
                          version(s)</span
                        >
                      </div>
                    </label>
                  </div>
                </div>

                <!-- --- Primary action: generate playlist --- -->
                <button id="generate-playlist" class="btn btn-primary btn-lg">
                  <i data-lucide="wand-2"></i>
                  Generate Playlist
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== Right Panel: results and diagnostics ===== -->
        <div class="right-panel">
          <div class="panel-header">
            <div class="header-left">
              <h2>
                <i data-lucide="list-music"></i>
                Your Playlist
              </h2>
            </div>
            <div class="header-actions">
              <!-- Clears current playlist and resets UI state -->
              <button id="clear-results" class="btn btn-ghost btn-sm">
                <i data-lucide="trash-2"></i>
                Clear
              </button>
            </div>
          </div>

          <div class="panel-content">
            <!-- Loading State: shown while generating or fetching -->
            <div id="loading" class="loading-state hidden">
              <div class="loading-spinner">
                <i data-lucide="loader-2" class="animate-spin"></i>
              </div>
              <h3>Generating your playlist</h3>
              <p>Finding the perfect tracks based on your preferences...</p>
            </div>

            <!-- Error State: surfaced API/client errors -->
            <div id="error-message" class="error-state hidden">
              <i data-lucide="alert-circle"></i>
              <p>Something went wrong</p>
            </div>

            <!-- Empty State: initial landing prompt -->
            <div class="empty-state">
              <i data-lucide="music-4" class="empty-icon"></i>
              <h3>Ready to create your playlist?</h3>
              <p>
                Configure your preferences on the left and hit generate to get
                started.
              </p>
            </div>

            <!-- Results: container for playlist metadata and track list -->
            <div id="playlist-results" class="playlist-results hidden">
              <div class="playlist-info">
                <div class="playlist-meta">
                  <!-- Generated name (inferred from seed tracks) -->
                  <h3 id="playlist-name">Generated Playlist</h3>

                  <!-- Summary stats: track count and mean similarity -->
                  <div class="playlist-stats">
                    <span id="track-count">
                      <i data-lucide="music"></i>
                      0 tracks
                    </span>
                    <span id="avg-similarity">
                      <i data-lucide="target"></i>
                      Avg Similarity: 0%
                    </span>
                  </div>
                </div>

                <!-- Export control: triggers CSV download -->
                <div class="playlist-actions">
                  <button id="export-playlist" class="btn btn-outline btn-sm">
                    <i data-lucide="download"></i>
                    Export
                  </button>
                </div>
              </div>

              <!-- Virtualized list container; rows populated by JS -->
              <div class="track-list-container">
                <div class="track-list-header">
                  <div class="track-header-cell track-number">#</div>
                  <div class="track-header-cell track-title">Title</div>
                  <div class="track-header-cell track-artist">Artist</div>
                  <div class="track-header-cell track-similarity">
                    Similarity
                  </div>
                  <div class="track-header-cell track-actions">Actions</div>
                </div>
                <div id="track-list" class="track-list">
                  <!-- Tracks will be added here dynamically -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== Modal: detailed track view with tags/features/lyrics ===== -->
    <div id="track-details-modal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-track-title">Track Details</h2>
          <!-- Dismisses the modal -->
          <button class="modal-close">
            <i data-lucide="x"></i>
          </button>
        </div>
        <div class="modal-body">
          <!-- Shown while fetching track details/similarity explanation -->
          <div id="modal-loading" class="loading-state">
            <div class="loading-spinner">
              <i data-lucide="loader-2" class="animate-spin"></i>
            </div>
            <p>Loading track details...</p>
          </div>
          <!-- Dynamic details markup injected by UI logic -->
          <div id="modal-track-details">
            <!-- Track details will be added here dynamically -->
          </div>
        </div>
      </div>
    </div>

    <!-- ===== Scripts: libraries and app bundles ===== -->
    <!-- Fuse.js for client-side fuzzy search (used by UI search refinements) -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

    <!-- Initialize icon rendering after library load -->
    <script>
      // Initialize Lucide icons
      lucide.createIcons();
    </script>

    <!-- Client-side API wrapper, UI logic, and bootstrapping -->
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
